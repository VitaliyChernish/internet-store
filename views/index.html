<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Сайт</title>
</head>

<body>
  <!-- <div
    style="display: flex; flex-direction: column; justify-content: center; align-items: center; position: fixed; width: 100vw; top: -50vh;">
    <img src="../static/24517c54-3057-418d-870a-7bcf644f6c01.png" alt="">
    <h1 style="display: block; position: relative; top: -70vh;">Backand for BeicoVideo </h1>
  </div> -->

  <!--
  <div style="display: flex;">
    <span></span>
    <div style="display: flex; flex-direction: column;">
      <button id="fetchAddSkills">Додати skill</button>
      <span>head:</span><input value="some header" type="text" id="skillHeader">
      <span>text body:</span><input value="some skill content" type="text" id="skillBody">
      <input type="file" id="imageUpload" accept="image/jpeg, image/png">
      <ul id="skillsList"></ul>
    </div>
    <div>
      <button id="fetchUsersBtn">Отримати список skill</button>
      <div id="usersList"></div>
    </div>
    <div style="display: flex; flex-direction: column;">
      <button id="fetchUsersBtn1">Залогінитись</button>
      <span>name:</span><input value="Vetal" type="text" id="nameInputLogin">
      <span>password:</span><input value="kleynod1023" type="text" id="passwordInputLogin">
      <ul id="usersList1"></ul>
    </div>
    <div>
      <button id="fetchUsersBtn2">Перевірити чи залогінився</button>
      <ul id="usersList2"></ul>
    </div>
    <div style="display: flex; flex-direction: column;">
      <button id="fetchUsersBtn3">Створити нового користувача</button>
      <span>name:</span><input type="text" id="nameInput">
      <span>password:</span><input type="text" id="passwordInput">
      <input type="file" id="avatarUpload" accept="image/jpeg, image/png">
      <ul id="usersList3"></ul>
    </div>
    <img src="../static/4721.png" alt="">
  </div>-->
  <div style="display: flex; justify-content: center; align-items: center; flex-direction: column; height: 100vh;">
    <h1>welcome to api</h1>
    <span>server created by Vitaliy</span>
    <a  href="mailto:vushneve23@gmail.com">vushneve23@gmail.com</a>
    <a href="https://t.me/Vitalii_Chernish">telegram</a>
  </div>

  <script>
    const fetchAddSkills = document.getElementById('fetchAddSkills');
    const skillsList = document.getElementById('skillsList');
    const imageUpload = document.getElementById('imageUpload')
    const avatarUpload = document.getElementById('avatarUpload')

    const fetchUsersBtn = document.getElementById('fetchUsersBtn');
    const usersList = document.getElementById('usersList');

    const fetchUsersBtn1 = document.getElementById('fetchUsersBtn1');
    const usersList1 = document.getElementById('usersList1');

    const fetchUsersBtn2 = document.getElementById('fetchUsersBtn2');
    const usersList2 = document.getElementById('usersList2');

    const fetchUsersBtn3 = document.getElementById('fetchUsersBtn3');
    const usersList3 = document.getElementById('usersList3');

    let token = ''

    //inputs....
    const skillHeader = document.getElementById('skillHeader');
    const skillBody = document.getElementById('skillBody');

    const nameInputLogin = document.getElementById('nameInputLogin');
    const passwordInputLogin = document.getElementById('passwordInputLogin');

    const nameInput = document.getElementById('nameInput');
    const passwordInput = document.getElementById('passwordInput');

    function showMessage(message, duration) {
      const alertContainer = document.createElement('div');
      alertContainer.textContent = message;
      alertContainer.style.position = 'fixed';
      alertContainer.style.top = '10px';
      alertContainer.style.left = '50%';
      alertContainer.style.transform = 'translateX(-50%)';
      alertContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
      alertContainer.style.color = 'white';
      alertContainer.style.padding = '10px';
      alertContainer.style.borderRadius = '5px';
      document.body.appendChild(alertContainer);

      setTimeout(function () {
        alertContainer.remove();
      }, duration);
    }

    function postSkills() {
      // const postData = {
      //   name: skillHeader.value,
      //   whyThis: skillBody.value,
      //   files: imageUpload
      // };

      const formData = new FormData();
      formData.append('header', skillHeader.value);
      formData.append('whyThis', skillBody.value);
      formData.append('file', imageUpload.files[0]);


      console.log(formData.get('file').name)
      fetch('/api/skill/create', {
        method: 'POST',
        headers: {
          // 'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        // body: JSON.stringify(postData)
        body: formData
      })
        .then(response => response.json())
        .then(data => {
          showMessage(...data + " запощено!", 3000);
        })
        .catch(error => {
          console.error(error);
        });
    }
    // Функція для отримання списку скілів з сервера
    function fetchSkills() {
      fetch('/api/skill/all')
        .then(response => response.json())
        .then(skills => {
          usersList.innerHTML = '';
          skills.forEach(skill => {
            let li = document.createElement('li');
            let img = document.createElement('img');
            li.style.display = 'flex';
            li.style.flexDirection = 'column'
            img.src = `./static/${encodeURIComponent(skill.img)}`;
            img.style.width = '250px';
            img.style.height = '200px';
            li.textContent = `${skill.id}: ${skill.header}`;
            li.style.border = '1px solid black'
            li.appendChild(img);
            usersList.appendChild(li);
          });
        })
        .catch(error => console.error(error));
    }

    function login() {
      const url = '/api/user/login'; // URL для логіну

      const userData = {
        nickName: nameInputLogin.value,
        password: passwordInputLogin.value
      };

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(userData)
      })
        .then(response => response.json())
        .then(data => {
          // Обробка відповіді сервера після логіну
          showMessage(data.message, 3000)
          token = data.token
        })
        .catch(error => {
          // Обробка помилок, якщо такі є
          console.error('Помилка при логіні:', error);
        });
    }

    function createUser() {
      const url = '/api/user/registration'; // URL для реєстрації

      const formDataUser = new FormData();

      formDataUser.append('nickName', nameInput.value);
      formDataUser.append('password', passwordInput.value);
      formDataUser.append('file', avatarUpload.files[0]);
      formDataUser.append('role', 'ADMINa');

      const userData = {
        nickName: nameInput.value,
        password: passwordInput.value,
        role: 'ADMINa'
      };

      fetch(url, {
        method: 'POST',
        body: formDataUser
      })
        .then(response => response.json())
        .then(data => {
          // Обробка відповіді сервера після реєстрації
          showMessage(data, 3000); // Результат реєстрації (наприклад, токен)
        })
        .catch(error => {
          // Обробка помилок, якщо такі є
          console.error('Помилка при реєстрації:', error);
        });
    }

    function checkAuth() {
      fetch('/api/user/auth', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
      })
        .then(response => response.json())
        .then(data => {
          showMessage(data.message, 3000); // Виведення повідомлення з сервера
        })
        .catch(error => {
          console.error('Помилка при перевірці авторизації file My_index.html:', error);
        });
    }

    fetchAddSkills.addEventListener('click', postSkills);
    fetchUsersBtn.addEventListener('click', fetchSkills);
    fetchUsersBtn1.addEventListener('click', login);
    fetchUsersBtn2.addEventListener('click', checkAuth);
    fetchUsersBtn3.addEventListener('click', createUser);
  </script>
</body>

</html>